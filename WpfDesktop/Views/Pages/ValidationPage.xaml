<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="WpfDesktop.Views.Pages.ValidationPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="Address Validation"
    mc:Ignorable="d">

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,24">
            <ui:TextBlock
                Text="Address Validation"
                FontSize="28"
                FontTypography="Title"/>
            <ui:TextBlock
                Text="Upload your XML file to validate address records"
                FontSize="14"
                Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"/>
        </StackPanel>

        <!-- Upload Section -->
        <ui:Card Grid.Row="1" Margin="0,0,0,24">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <DockPanel Grid.Row="0" LastChildFill="True" Margin="0,0,0,12">
                    <ui:Button
                        Margin="8,0,0,0"
                        Appearance="Primary"
                        DockPanel.Dock="Right"
                        Content="Upload"
                        Icon="Upload24"
                        Command="{Binding UploadCommand}"/>
                    <ui:TextBox
                        Icon="Document24"
                        PlaceholderText="Select XML file"
                        Text="{Binding SelectedFilePath, Mode=OneWay}"
                        IsReadOnly="True"/>
                </DockPanel>

                <ui:InfoBar
                    Grid.Row="2"
                    IsOpen="{Binding IsProcessing}"
                    Message="Processing XML file..."
                    Severity="Informational"
                    IsClosable="False"/>
            </Grid>
        </ui:Card>

        <!-- Validation Results -->
        <ScrollViewer Grid.Row="2">
            <StackPanel>
                <!-- Summary Statistics -->
                <Grid Margin="0,0,0,24">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Compliance Rates -->
                    <ui:Card Grid.Column="0" Grid.ColumnSpan="2" Margin="0,0,12,0">
                        <StackPanel>
                            <ui:TextBlock
             Text="Compliance Rates"
             FontSize="16"
             FontWeight="Medium"
             Margin="0,0,0,16"/>

                            <Grid Margin="0,0,0,12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="160"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="60"/>
                                </Grid.ColumnDefinitions>

                                <ui:TextBlock
                 Grid.Column="0"
                 Text="Address Compliance"
                 VerticalAlignment="Center"/>
                                <ProgressBar
                 Grid.Column="1"
                 Value="{Binding MailingResponse.AddressComplianceRate}"
                 Maximum="100"
                 Margin="12,0"/>
                                <ui:TextBlock
                 Grid.Column="2"
                 Text="{Binding MailingResponse.AddressComplianceRate, StringFormat={}{0}%}"
                 VerticalAlignment="Center"
                 HorizontalAlignment="Right"/>
                            </Grid>

                            <Grid Margin="0,0,0,12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="160"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="60"/>
                                </Grid.ColumnDefinitions>

                                <ui:TextBlock
                 Grid.Column="0"
                 Text="Building Compliance"
                 VerticalAlignment="Center"/>
                                <ProgressBar
                 Grid.Column="1"
                 Value="{Binding MailingResponse.BuildingComplianceRate}"
                 Maximum="100"
                 Margin="12,0"/>
                                <ui:TextBlock
                 Grid.Column="2"
                 Text="{Binding MailingResponse.BuildingComplianceRate, StringFormat={}{0}%}"
                 VerticalAlignment="Center"
                 HorizontalAlignment="Right"/>
                            </Grid>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="160"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="60"/>
                                </Grid.ColumnDefinitions>

                                <ui:TextBlock
                 Grid.Column="0"
                 Text="Presorting Compliance"
                 VerticalAlignment="Center"/>
                                <ProgressBar
                 Grid.Column="1"
                 Value="{Binding MailingResponse.PresortingComplianceRate}"
                 Maximum="100"
                 Margin="12,0"/>
                                <ui:TextBlock
                 Grid.Column="2"
                 Text="{Binding MailingResponse.PresortingComplianceRate, StringFormat={}{0}%}"
                 VerticalAlignment="Center"
                 HorizontalAlignment="Right"/>
                            </Grid>
                        </StackPanel>
                    </ui:Card>

                    <ui:Card Grid.Column="2" Margin="4,0,8,0">
                        <StackPanel>
                            <ui:TextBlock
             Text="Warnings"
             Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"/>
                            <ui:TextBlock
             Text="{Binding MailingResponse.RecordsWithWarnings}"
             FontSize="32"
             FontWeight="Medium"
             Foreground="#FFC107"/>
                        </StackPanel>
                    </ui:Card>

                    <ui:Card Grid.Column="3" Margin="12,0,0,0">
                        <StackPanel>
                            <ui:TextBlock
             Text="Errors"
             Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"/>
                            <ui:TextBlock
             Text="{Binding MailingResponse.RecordsWithErrors}"
             FontSize="32"
             FontWeight="Medium"
             Foreground="#F44336"/>
                        </StackPanel>
                    </ui:Card>
                </Grid>

                <!-- Warning Details -->
                <ui:Card>
                    <StackPanel>
                        <Grid Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <ui:TextBlock
                                Grid.Column="0"
                                Text="Addresses with Warnings and Errors"
                                FontSize="16"
                                FontWeight="Medium"/>

                            <ui:Button
                                Grid.Column="1"
                                Content="Download file"
                                Command ="{Binding DownloadCommand}"
                                Icon="ArrowRight24"
                               />
                        </Grid>

                        <ui:DataGrid 
        ItemsSource="{Binding AddressResponses}"
        AutoGenerateColumns="False"
        Background="Transparent"
        GridLinesVisibility="Horizontal"
        BorderThickness="1"
        IsReadOnly="True"
        SelectionMode="Single"
        SelectionUnit="FullRow">        

                            <ui:DataGrid.Resources>
                                <Style TargetType="DataGridCell">
                                    <Setter Property="Foreground" Value="{ui:ThemeResource TextFillColorPrimaryBrush}" />
                                    <Style.Triggers>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Background" Value="{ui:ThemeResource AccentTextFillColorPrimaryBrush}" />
                                            <Setter Property="Foreground" Value="{ui:ThemeResource TextFillColorInverseBrush}" />
                                        </Trigger>
                                        <DataTrigger Binding="{Binding Severity}" Value="ERROR">
                                            <Setter Property="Foreground" Value="Red" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ui:DataGrid.Resources>

                            <ui:DataGrid.Columns>
                                <DataGridTextColumn 
            Header="Sequence" 
            Binding="{Binding Sequence}" 
            Width="100">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="VerticalAlignment" Value="Center" />
                                            <Setter Property="Margin" Value="8,0" />
                                            
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>

                                <DataGridTextColumn 
            Header="Severity" 
            Binding="{Binding Severity}" 
            Width="100">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="VerticalAlignment" Value="Center" />
                                            <Setter Property="Margin" Value="8,0" />
                                           
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>

                                <DataGridTextColumn 
            Header="Code" 
            Binding="{Binding StatusCode}" 
            Width="100">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="VerticalAlignment" Value="Center" />
                                            <Setter Property="Margin" Value="8,0" />
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>

                                <DataGridTextColumn 
            Header="Description" 
            Binding="{Binding Message}" 
            Width="600">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="VerticalAlignment" Value="Center" />
                                            <Setter Property="Margin" Value="8,0" />
                                            <Setter Property="TextWrapping" Value="Wrap" />
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                            </ui:DataGrid.Columns>
                        </ui:DataGrid>
                        
                    </StackPanel>
                </ui:Card>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
